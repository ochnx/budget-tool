"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{38177:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var r=a(3827),s=a(64090),n=a(14958),i=a(46491),l=a.n(i),o=a(18695),d=a(10632),c=a(98998),m=a(80037),u=a(18994),x=a(69475);function h(){let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)([]),[h,g]=(0,s.useState)(new Map),[p,f]=(0,s.useState)(!1),[k,b]=(0,s.useState)(!1),[v,N]=(0,s.useState)(0),[y,j]=(0,s.useState)(null),[w,S]=(0,s.useState)(!1),z=(0,s.useRef)(null);async function D(){let{data:e}=await n.O.from("categories").select("*").order("sort_order");e&&t(e)}function _(t){j(null),b(!1);let a=new FileReader;a.onload=t=>{try{var a;let r=null===(a=t.target)||void 0===a?void 0:a.result,s=function(e){let t=l().parse(e,{header:!0,delimiter:";",skipEmptyLines:!0});return t.errors.length>0&&console.warn("CSV Parse Warnings:",t.errors),t.data.filter(e=>e.Buchungstag&&e.Betrag).map(e=>{var t;let a=(t=e.Betrag)&&parseFloat(t.trim().replace(/\./g,"").replace(",","."))||0,r=e.Verwendungszweck||"",s=e.Buchungstext||"",n=e["Beguenstigter/Zahlungspflichtiger"]||"";return{date:function(e){let t=e.trim().split(".");if(3!==t.length)return e;let[a,r,s]=t;return"".concat(s,"-").concat(r.padStart(2,"0"),"-").concat(a.padStart(2,"0"))}(e.Buchungstag),amount:Math.abs(a),description:r||s,recipient:n,is_income:a>0}})}(r);if(0===s.length){j("Keine Transaktionen in der CSV-Datei gefunden. Stimmt das Format?");return}i(s);let n=new Map;s.forEach((t,a)=>{let r=(0,o.Wd)(t.description,t.recipient,t.amount);if(r){let t=e.find(e=>e.name===r);t&&n.set(a,t.id)}}),g(n)}catch(e){j("Fehler beim Parsen der CSV-Datei. Bitte \xfcberpr\xfcfe das Format."),console.error(e)}},a.readAsText(t,"ISO-8859-1")}async function C(){f(!0),j(null);try{let e=a.map((e,t)=>({date:e.date,amount:e.amount,description:e.description,recipient:e.recipient,is_income:e.is_income,category_id:h.get(t)||null})),t=0;for(let a=0;a<e.length;a+=50){let r=e.slice(a,a+50),{error:s}=await n.O.from("transactions").insert(r);if(s)throw s;t+=r.length}N(t),b(!0),i([])}catch(e){j("Import fehlgeschlagen: ".concat(e.message))}finally{f(!1)}}(0,s.useEffect)(()=>{D()},[]);let F=h.size,E=a.length,B=a.filter(e=>e.is_income).length,I=a.filter(e=>!e.is_income).length,M=a.filter(e=>e.is_income).reduce((e,t)=>e+t.amount,0),T=a.filter(e=>!e.is_income).reduce((e,t)=>e+t.amount,0);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"CSV Import"}),(0,r.jsx)("p",{className:"text-dark-400",children:"Lade deinen Sparkasse Kontoauszug hoch (CSV-Datei). Die Transaktionen werden automatisch geparst und kategorisiert."}),0===a.length&&(0,r.jsxs)("div",{onDragOver:e=>{e.preventDefault(),S(!0)},onDragLeave:()=>S(!1),onDrop:function(e){e.preventDefault(),S(!1);let t=e.dataTransfer.files[0];t&&_(t)},onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},className:"\n            glass rounded-2xl p-12 border-2 border-dashed cursor-pointer\n            flex flex-col items-center justify-center gap-4\n            transition-all duration-300\n            ".concat(w?"border-emerald-400 bg-emerald-500/5":"border-dark-600 hover:border-dark-400 hover:bg-dark-800/50","\n          "),children:[(0,r.jsx)("div",{className:"p-4 rounded-2xl ".concat(w?"bg-emerald-500/15":"bg-dark-700"),children:(0,r.jsx)(d.Z,{size:32,className:w?"text-emerald-400":"text-dark-400"})}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-lg font-medium text-dark-200",children:"CSV-Datei hier ablegen"}),(0,r.jsx)("p",{className:"text-sm text-dark-400 mt-1",children:"oder klicken zum Ausw\xe4hlen • Sparkasse Format (Semikolon-getrennt)"})]}),(0,r.jsx)("input",{ref:z,type:"file",accept:".csv,.CSV",onChange:function(e){var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&_(a)},className:"hidden"})]}),y&&(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-red-500/10 border border-red-500/20 rounded-xl",children:[(0,r.jsx)(c.Z,{size:20,className:"text-red-400 flex-shrink-0"}),(0,r.jsx)("p",{className:"text-sm text-red-300",children:y})]}),k&&(0,r.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl",children:[(0,r.jsx)(m.Z,{size:20,className:"text-emerald-400 flex-shrink-0"}),(0,r.jsxs)("p",{className:"text-sm text-emerald-300",children:[v," Transaktionen erfolgreich importiert! \uD83C\uDF89"]})]}),a.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"glass rounded-xl p-4 text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-dark-100",children:E}),(0,r.jsx)("p",{className:"text-xs text-dark-400 mt-1",children:"Transaktionen"})]}),(0,r.jsxs)("div",{className:"glass rounded-xl p-4 text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-emerald-400",children:(0,o.xG)(M)}),(0,r.jsxs)("p",{className:"text-xs text-dark-400 mt-1",children:[B," Einnahmen"]})]}),(0,r.jsxs)("div",{className:"glass rounded-xl p-4 text-center",children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-red-400",children:(0,o.xG)(T)}),(0,r.jsxs)("p",{className:"text-xs text-dark-400 mt-1",children:[I," Ausgaben"]})]}),(0,r.jsxs)("div",{className:"glass rounded-xl p-4 text-center",children:[(0,r.jsxs)("p",{className:"text-2xl font-bold text-cyan-400",children:[Math.round(F/E*100),"%"]}),(0,r.jsx)("p",{className:"text-xs text-dark-400 mt-1",children:"Kategorisiert"})]})]}),(0,r.jsxs)("div",{className:"glass rounded-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"hidden sm:grid grid-cols-12 gap-2 px-4 py-3 bg-dark-800/60 border-b border-dark-700/50 text-xs font-semibold text-dark-400 uppercase tracking-wider",children:[(0,r.jsx)("div",{className:"col-span-2",children:"Datum"}),(0,r.jsx)("div",{className:"col-span-3",children:"Empf\xe4nger"}),(0,r.jsx)("div",{className:"col-span-3",children:"Beschreibung"}),(0,r.jsx)("div",{className:"col-span-2",children:"Kategorie"}),(0,r.jsx)("div",{className:"col-span-2 text-right",children:"Betrag"})]}),(0,r.jsx)("div",{className:"divide-y divide-dark-700/30 max-h-[500px] overflow-y-auto",children:a.map((t,a)=>{let s=h.get(a);return e.find(e=>e.id===s),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-12 gap-2 px-4 py-3 hover:bg-dark-700/30 items-center",children:[(0,r.jsx)("div",{className:"sm:col-span-2 text-sm text-dark-300",children:new Date(t.date).toLocaleDateString("de-DE")}),(0,r.jsx)("div",{className:"sm:col-span-3 text-sm font-medium text-dark-100 truncate",children:t.recipient||"—"}),(0,r.jsx)("div",{className:"sm:col-span-3 text-sm text-dark-400 truncate",children:t.description||"—"}),(0,r.jsx)("div",{className:"sm:col-span-2",children:(0,r.jsxs)("select",{value:s||"",onChange:e=>(function(e,t){let a=new Map(h);t?a.set(e,t):a.delete(e),g(a)})(a,e.target.value),className:"w-full px-2 py-1.5 bg-dark-700 border border-dark-600 rounded-lg text-xs text-dark-100 focus:outline-none focus:ring-2 focus:ring-emerald-500/50",children:[(0,r.jsx)("option",{value:"",children:"— Keine —"}),e.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.icon," ",e.name]},e.id))]})}),(0,r.jsxs)("div",{className:"sm:col-span-2 text-sm font-bold text-right ".concat(t.is_income?"text-emerald-400":"text-red-400"),children:[t.is_income?"+":"-",(0,o.xG)(t.amount)]})]},a)})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("button",{onClick:()=>{i([]),g(new Map)},className:"px-4 py-2.5 bg-dark-700 hover:bg-dark-600 rounded-xl text-sm font-medium text-dark-300",children:"Abbrechen"}),(0,r.jsx)("button",{onClick:C,disabled:p,className:"flex items-center gap-2 px-6 py-2.5 bg-emerald-500 hover:bg-emerald-600 disabled:opacity-50 text-white rounded-xl text-sm font-bold shadow-lg shadow-emerald-500/25",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.Z,{size:16,className:"animate-spin"}),"Importiere..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{size:16}),E," Transaktionen importieren"]})})]})]})]})}},18695:function(e,t,a){a.d(t,{Wd:function(){return s},ZY:function(){return i},xG:function(){return n}});let r=[{categoryName:"Miete",keywords:["miete","mietvertrag","kaltmiete","warmmiete","nebenkosten","hausverwaltung","wohnungsbau"]},{categoryName:"Lebensmittel",keywords:["rewe","edeka","aldi","lidl","netto","penny","kaufland","dm-drogerie","dm ","rossmann","supermarkt","lebensmittel","norma","real"]},{categoryName:"Klamotten",keywords:["zara","h&m","zalando","about you","aboutyou","asos","nike","adidas","cos ","uniqlo","pull&bear","bershka","massimo dutti","mango","snipes","foot locker","footlocker","mr porter","end clothing","ssense","farfetch","kickz","hhv"]},{categoryName:"Transport",keywords:["db ","deutsche bahn","bahn","deutschlandticket","mvv","uber","bolt","freenow","free now","tier","lime","voi","tankstelle","aral","shell","esso","jet tanken","adac","flixbus","taxi"]},{categoryName:"Restaurants",keywords:["restaurant","lieferando","uber eats","ubereats","wolt","doordash","mcdonalds","mcdonald","burger king","subway","starbucks","cafe","kaffee","pizz","sushi","kebab","d\xf6ner","gastronomie","bistro"]},{categoryName:"Abos & Subscriptions",keywords:["spotify","netflix","disney+","amazon prime","apple","icloud","google storage","youtube premium","crunchyroll","chatgpt","openai","notion","figma","adobe","microsoft","github","vercel","hetzner","digitalocean","cloudflare","fitnessstudio","mcfit","gym","john reed"]},{categoryName:"Gesundheit",keywords:["apotheke","arzt","praxis","krankenhaus","klinik","physiotherapie","zahnarzt","krankenkasse","tk ","aok","barmer","dak"]},{categoryName:"Entertainment",keywords:["kino","cinema","steam","playstation","xbox","nintendo","gaming","konzert","ticket","eventim","club","disco","party","festival"]},{categoryName:"Geschenke",keywords:["geschenk","blume","fleurop","amazon.de marketplace"]},{categoryName:"Gehalt",keywords:["gehalt","lohn","verg\xfctung","arbeitgeber"]},{categoryName:"Freelance",keywords:["honorar","rechnung","freelance","projekt","beratung"]}];function s(e,t,a){let s="".concat(e," ").concat(t).toLowerCase();for(let e of r)for(let t of e.keywords)if(s.includes(t.toLowerCase()))return e.categoryName;return null}function n(e){return new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR"}).format(e)}function i(e){return["Januar","Februar","M\xe4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"][e]}},14958:function(e,t,a){a.d(t,{O:function(){return r}});let r=(0,a(27688).eI)("https://lvhxabadywdqeepymwdm.supabase.co","sb_publishable_bF5kedUI50llEI-r1yaxIg_8Q6sauiD")}}]);